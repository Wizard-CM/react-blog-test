var W=Object.defineProperty;var A=(t,r,a)=>r in t?W(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a;var f=(t,r,a)=>A(t,typeof r!="symbol"?r+"":r,a);import{b as z,D as O,c as n,I as T,Q as B,r as m,d as M,e as Q,f as Y,g as R,a as G,s as h,j as e,h as H,C as J,m as C,p as K,i as U,L as V,B as v,T as X,k as Z}from"./index-CoApRtb5.js";class _{constructor(){f(this,"client",new z);f(this,"databases");this.client.setEndpoint("https://cloud.appwrite.io/v1").setProject("67063d5c0003cd312df2"),this.databases=new O(this.client)}async createComment({commentator:r,comment:a,postId:i}){try{return await this.databases.createDocument(n.appWriteDatabaseId,n.appWriteCommentCollectionId,T.unique(),{commentator:r,comment:a,postId:i})}catch(d){return console.log(d),d}}async getCommentsOfPost(r){try{return await this.databases.listDocuments(n.appWriteDatabaseId,n.appWriteCommentCollectionId,[B.equal("postId",r)])}catch(a){return console.log(a),a}}async likePost({postId:r,likes:a}){try{await this.databases.updateDocument(n.appWriteDatabaseId,n.appWriteCollectionId,r,{likes:a})}catch{}}}const g=new _,se=()=>{var y,w;const[t,r]=m.useState(null),[a,i]=m.useState([]),[d,j]=m.useState(null),[D,I]=m.useState(!0),{slug:o}=M(),x=Q(),{register:b,handleSubmit:k,formState:{errors:u},reset:P}=Y(),S=R(),c=new Date(t==null?void 0:t.$createdAt),N=G(s=>s.auth.userData),F=t&&N?t.userId===N.$id:!1,L=s=>{const p={commentator:s.commentator,comment:s.comment,postId:o};g.createComment(p).then(l=>{i(q=>[...q,{commentator:s.commentator,comment:s.comment,postId:o,$createdAt:new Date}])}),P({commentator:"",comment:""})},$=()=>{h.deletePost(t.$id).then(s=>{s&&(h.deleteFile(t.featuredImage),S(Z(t.$id)),x("/"))})},E=()=>{j(s=>s+1),g.likePost({postId:o,likes:d+1})};return m.useEffect(()=>{o?h.getSinglePost(o).then(s=>{s?(r(s),j(s.likes),I(!1)):x("/")}):x("/")},[o,x]),m.useEffect(()=>{g.getCommentsOfPost(o).then(s=>{a.length!=s.documents.length&&i(s.documents)})},[a]),D?e.jsx(H,{}):t?e.jsx("div",{className:"py-8 w-full",children:e.jsxs(J,{children:[e.jsxs("div",{className:"w-full flex flex-col md:flex-row gap-5 border-b-[1px] border-gray-900 pb-4",children:[e.jsx("div",{className:"left w-full md:w-[40%]",children:e.jsx("img",{src:h.getFilePreview(t==null?void 0:t.featuredImage),alt:t.title,className:"rounded-xl min-w-[300px] w-full h-[100%] max-h-[400px] object-contain"})}),e.jsxs("div",{className:"right w-full md:w-[55%] text-center md:text-start",children:[e.jsxs("div",{className:"flex gap-3 font-mono w-full justify-center md:justify-start",children:[e.jsxs("p",{className:"text-[0.8rem] capitalize",children:["Author : ",t.userName]}),e.jsxs("p",{className:"text-[0.8rem]",children:[C[c==null?void 0:c.getMonth()]," ",c==null?void 0:c.getDate(),",",c==null?void 0:c.getFullYear()]})]}),e.jsx("h3",{className:"text-4xl md:text-5xl lg:text-6xl font-serif mb-3",children:t.title}),e.jsx("span",{className:"browser-css text-gray-700",children:K(t.content)}),e.jsxs("div",{className:"flex items-center gap-4 w-full justify-center md:justify-start",children:[e.jsx("button",{className:"my-2 px-2 bg-[#F0F0F0] border-[1px] text-[0.9rem] font-serif rounded-lg capitalize text-blue-600",children:t.category}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{}),e.jsx("p",{className:" px-1  text-[0.7rem]  font-bold",children:d})]})]}),F&&e.jsxs("div",{className:"my-3",children:[e.jsx(V,{to:`/edit-post/${t.$id}`,children:e.jsx(v,{className:"mr-3 bg-green-600",children:"Edit"})}),e.jsx(v,{className:"bg-red-600",onClick:()=>{$(),X({message:"Post Successfully Deleted"})},children:"Delete"})]}),e.jsx("button",{onClick:E,className:"mr-3 px-5 py-2 rounded-md border-2 border-gray-900",children:"Like"})]})]}),e.jsx("h3",{className:"text-5xl font-serif my-9 text-center",children:"Comments Section"}),e.jsxs("div",{className:"flex gap-5 flex-col md:flex-row",children:[e.jsx("div",{className:"left w-full md:w-[40%] md:border-r-[1px]  pr-4 border-gray-900 ",children:e.jsxs("form",{onSubmit:k(L),className:"flex flex-col w-full mt-4 gap-3",children:[e.jsx("input",{placeholder:"Enter Commentator Name..",className:"border-[2px] px-3 py-2",...b("commentator",{required:"Name of commentator is required"})}),u.commentator&&e.jsx("p",{className:"text-red-600 text-[0.8rem] m-0",role:"alert",children:(y=u.commentator)==null?void 0:y.message}),e.jsx("textarea",{placeholder:"Comment...",rows:10,className:"border-[2px] px-3 py-2",...b("comment",{required:"Comment is required"})}),u.comment&&e.jsx("p",{className:"text-red-600 text-[0.8rem] m-0",role:"alert",children:(w=u.comment)==null?void 0:w.message}),e.jsx("button",{className:"bg-gray-900 text-white py-2 rounded-md",children:"Create Comment"})]})}),e.jsx("div",{className:"right  w-full md:w-[55%] ",children:a.length>0?a.map((s,p)=>{const l=new Date(s.$createdAt);return e.jsxs("div",{className:"border-b-[1px] border-gray-300 p-3",children:[e.jsxs("div",{className:"flex gap-3 font-mono",children:[e.jsx("p",{className:"text-[0.7rem] capitalize",children:s.commentator}),e.jsxs("p",{className:"text-[0.7rem]",children:[C[l==null?void 0:l.getMonth()]," ",l==null?void 0:l.getDate(),",",l==null?void 0:l.getFullYear()]})]}),e.jsx("h4",{className:"text-xl",children:s.comment})]},p)}):e.jsx("h3",{className:"text-3xl text-center w-full mt-10",children:"No Comments To Show"})})]})]})}):null};export{se as default};
